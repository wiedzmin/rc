- include_vars: golang.yml
  tags: [golang]

- name: check packages installed
  tags: [golang]
  stat:
    path: "{{ go_src_path }}/{{ item.url }}"
  register: packages_paths
  with_items: "{{ go_package_urls }}"

- name: install Go packages from source
  tags: [golang]
  command: "go get -u {{ item.0.url }}"
  with_together:
    - "{{ go_package_urls }}"
    - "{{ packages_paths.results }}"
  become: "{{ item.0.become }}"
  when: "not item.1.stat.exists"

- name: symlink Go tools binaries to mainstream path
  tags: [golang]
  file:
    src: "{{ item }}"
    dest: "/usr/bin/{{ item | basename }}"
    state: link
  with_fileglob:
    - "{{ go_bin_path }}/*"
  become: yes
  ignore_errors: yes

- name: setup gometalinter
  tags: [golang]
  shell: gometalinter --install --update
  with_first_found:
    - files:
        - gometalinter
      paths:
        - "{{ go_bin_path }}"
